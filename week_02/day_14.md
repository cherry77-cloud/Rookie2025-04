## 一. `SQL` 查询语句的执行流程

### 1. 连接器
- **功能**：负责与客户端建立连接、获取权限、维持和管理连接。
- **细节**：
  - 客户端通过 `TCP` 连接与 `MySQL` 服务器建立连接。
  - 连接器验证用户名和密码，并检查用户权限。
  - 连接成功后，如果没有后续操作，连接会进入空闲状态。如果长时间空闲，连接器会自动断开连接。

### 2. 查询缓存（`MySQL 8.0` 已移除）
- **功能**：`MySQL` 拿到查询请求后，会先检查查询缓存，看是否之前执行过相同的查询。
- **细节**：
  - 如果查询命中缓存，直接返回缓存结果。
  - 如果未命中缓存，继续后续步骤。
  - 查询缓存以 `key-value` 形式存储，`key` 是查询语句，`value` 是查询结果。
  - **注意**：`MySQL 8.0` 及以上版本已移除查询缓存功能，因为缓存命中率低且维护成本高。

### 3. 分析器
- **功能**：对 `SQL` 语句进行词法分析和语法分析。
- **细节**：
  - **词法分析**：识别 `SQL` 语句中的关键字、表名、列名等。
  - **语法分析**：检查 `SQL` 语句是否符合语法规则。
  - 如果 `SQL` 语句有语法错误，分析器会抛出错误。

### 4. 优化器
- **功能**：决定 `SQL` 语句的执行计划。
- **细节**：
  - 选择使用哪个索引（如果有多个索引）。
  - 决定多表关联（`JOIN`）的顺序。
  - 生成最优的执行计划。

### 5. 执行器
- **功能**：执行 `SQL` 语句并返回结果。
- **细节**：
  - 执行器首先检查用户是否有执行该查询的权限。
  - 调用存储引擎接口，执行查询操作。
  - 返回查询结果给客户端。

---

## 二. 事务的四大特性（`ACID`）

### 1. 原子性（`Atomicity`）
- **定义**：事务中的所有操作要么全部成功，要么全部失败回滚。
- **作用**：确保事务的完整性，避免部分操作成功、部分操作失败的情况。

### 2. 一致性（`Consistency`）
- **定义**：事务执行前后，数据库从一个一致性状态转变到另一个一致性状态。
- **作用**：确保数据库的约束条件（如唯一性、外键等）在事务执行前后都得到满足。

### 3. 隔离性（`Isolation`）
- **定义**：多个事务并发执行时，每个事务都应该被隔离开来，一个事务的执行不应该影响其他事务的执行。
- **作用**：避免并发事务之间的数据干扰。

### 4. 持久性（`Durability`）
- **定义**：一旦事务提交，它对数据库的改变就是永久性的，即使在系统故障或崩溃后也能够保持。
- **作用**：确保数据的持久存储。

---

## 三. 数据库的事务隔离级别

### 1. 读未提交（`READ UNCOMMITTED`）
- **定义**：允许一个事务读取另一个事务尚未提交的数据修改。
- **问题**：
  - **脏读**：读取到未提交的数据，可能导致数据不一致。
  - **不可重复读**：同一事务中多次读取同一数据，结果可能不同。
  - **幻读**：同一事务中多次查询，结果集可能不同。

### 2. 读已提交（`READ COMMITTED`）
- **定义**：一个事务只能读取已经提交的数据。其他事务的修改在该事务提交之后才可见。
- **问题**：
  - **不可重复读**：同一事务中多次读取同一数据，结果可能不同。
  - **幻读**：同一事务中多次查询，结果集可能不同。

### 3. 可重复读（`REPEATABLE READ`）
- **定义**：事务执行期间，多次读取同一数据会得到相同的结果，即在事务开始和结束之间，其他事务对数据的修改不可见。
- **问题**：
  - **幻读**：同一事务中多次查询，结果集可能不同。

### 4. 序列化（`SERIALIZABLE`）
- **定义**：最高的隔离级别，确保事务之间的并发执行效果与串行执行的效果相同。
- **特点**：
  - 解决了脏读、不可重复读和幻读问题。
  - 性能最差，因为所有事务都串行执行。
